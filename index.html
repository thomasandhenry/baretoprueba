<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurante Interactivo</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <!-- Estilo CSS personalizado -->
    <style>
        /* Estilo para los botones de las secciones */
        button.section {
            padding: 10px 20px;
            font-size: 18px;
            background-color: green;
            color: white;
            border: none;
            cursor: pointer;
            margin: 5px;
        }

        /* Estilo para los botones de los platos */
        .dish {
            display: flex;
            align-items: center;
            margin: 5px 5px 5px 25px; /* Agregar margen izquierdo para tabular */
        }

        .dish span {
            flex-grow: 1;
        }

        .dish button {
            padding: 10px;
            font-size: 18px;
            background-color: blue;
            color: white;
            border: none;
            cursor: pointer;
            margin-left: 10px;
        }

        /* Estilo para los botones al pasar el ratón */
        button:hover {
            opacity: 0.8;
        }

        /* Disposición vertical de las mesas */
        #main {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #main button {
            width: 200px;
        }

        /* Ocultar lista desplegable por defecto */
        .dropdown-content {
            display: none;
            flex-direction: column;
            align-items: flex-start;
        }

        /* Mostrar lista desplegable cuando se hace clic */
        .show {
            display: flex;
        }

        /* Estilo para el contenedor de cocina */
        #kitchenContent {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        /* Estilo para la lista de pedidos */
        .order-list {
            list-style-type: none;
            padding-left: 20px;
        }

        .order-item {
            margin-left: 20px;
        }

        .order-item-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
        }

        .order-item-control button {
            padding: 5px 10px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div id="main">
        <h1>Selecciona tu mesa</h1>
        <button class="section" onclick="goToCustomer(1)">Mesa 1</button>
        <button class="section" onclick="goToCustomer(2)">Mesa 2</button>
        <button class="section" onclick="goToCustomer(3)">Mesa 3</button>
        <button class="section" onclick="goToCustomer(4)">Mesa 4</button>
        <button class="section" onclick="goToCustomer(5)">Mesa 5</button>
        <button class="section" onclick="goToCustomer(6)">Mesa 6</button>
        <button class="section" onclick="goToCustomer(7)">Mesa 7</button>
        <button class="section" onclick="goToCustomer(8)">Mesa 8</button>
        <button class="section" onclick="goToCustomer(9)">Mesa 9</button>
        <button class="section" onclick="goToCustomer(10)">Mesa 10</button>
        <button class="section" onclick="goToKitchen()">COCINA</button>
    </div>

    <div id="customer" style="display:none;">
        <h1>Cliente - Mesa <span id="tableNumber"></span></h1>
        <div>
            <button class="section" onclick="toggleDropdown('entrantes')">Entrantes</button>
            <div id="entrantes" class="dropdown-content">
                <div class="dish"><span>Jamón ibérico - 5€ (<span id="provisionalQuantity-Jamón ibérico">0</span>)</span><button onclick="addProvisionalOrder('Jamón ibérico', 5)">+</button></div>
                <div class="dish"><span>Ensaladilla rusa - 3€ (<span id="provisionalQuantity-Ensaladilla rusa">0</span>)</span><button onclick="addProvisionalOrder('Ensaladilla rusa', 3)">+</button></div>
                <div class="dish"><span>Croquetas - 4€ (<span id="provisionalQuantity-Croquetas">0</span>)</span><button onclick="addProvisionalOrder('Croquetas', 4)">+</button></div>
            </div>
        </div>
        <div>
            <button class="section" onclick="toggleDropdown('platosPrincipales')">Platos principales</button>
            <div id="platosPrincipales" class="dropdown-content">
                <div class="dish"><span>Filete de ternera - 12€ (<span id="provisionalQuantity-Filete de ternera">0</span>)</span><button onclick="addProvisionalOrder('Filete de ternera', 12)">+</button></div>
                <div class="dish"><span>Merluza al horno - 10€ (<span id="provisionalQuantity-Merluza al horno">0</span>)</span><button onclick="addProvisionalOrder('Merluza al horno', 10)">+</button></div>
                <div class="dish"><span>Tartar de salmón y aguacate - 15€ (<span id="provisionalQuantity-Tartar de salmón y aguacate">0</span>)</span><button onclick="addProvisionalOrder('Tartar de salmón y aguacate', 15)">+</button></div>
            </div>
        </div>
        <div>
            <button class="section" onclick="toggleDropdown('postres')">Postres</button>
            <div id="postres" class="dropdown-content">
                <div class="dish"><span>Tarta de la abuela - 5€ (<span id="provisionalQuantity-Tarta de la abuela">0</span>)</span><button onclick="addProvisionalOrder('Tarta de la abuela', 5)">+</button></div>
                <div class="dish"><span>Natillas - 3€ (<span id="provisionalQuantity-Natillas">0</span>)</span><button onclick="addProvisionalOrder('Natillas', 3)">+</button></div>
                <div class="dish"><span>Tarta de queso y fruta - 6€ (<span id="provisionalQuantity-Tarta de queso y fruta">0</span>)</span><button onclick="addProvisionalOrder('Tarta de queso y fruta', 6)">+</button></div>
            </div>
        </div>
        <div>
            <button class="section" onclick="toggleDropdown('bebidas')">Bebidas</button>
            <div id="bebidas" class="dropdown-content">
                <div class="dish"><span>Cocacola - 2€ (<span id="provisionalQuantity-Cocacola">0</span>)</span><button onclick="addProvisionalOrder('Cocacola', 2)">+</button></div>
                <div class="dish"><span>Agua - 1€ (<span id="provisionalQuantity-Agua">0</span>)</span><button onclick="addProvisionalOrder('Agua', 1)">+</button></div>
                <div class="dish"><span>Cerveza - 3€ (<span id="provisionalQuantity-Cerveza">0</span>)</span><button onclick="addProvisionalOrder('Cerveza', 3)">+</button></div>
                <div class="dish"><span>Vino - 4€ (<span id="provisionalQuantity-Vino">0</span>)</span><button onclick="addProvisionalOrder('Vino', 4)">+</button></div>
            </div>
        </div>
        <button class="section" onclick="goToProvisionalOrder()">Tramitar pedido</button>
    </div>

    <div id="provisionalOrder" style="display:none;">
        <h1>Pedido Provisional</h1>
        <div id="provisionalOrderList"></div>
        <button class="section" onclick="confirmOrder()">Confirmar pedido</button>
        <button class="section" onclick="goToCustomer(currentTable)">ATRÁS</button>
    </div>

    <div id="kitchen" style="display:none;">
        <h1>COCINA</h1>
        <div id="kitchenContent"></div>
        <button class="section" onclick="goToMain()">VOLVER</button>
	
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD8h3lzN5yP5N0aZNjdmy7kDI0aClUc_Wk",
            authDomain: "clasepruebagad.firebaseapp.com",
            databaseURL: "https://clasepruebagad-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "clasepruebagad",
            storageBucket: "clasepruebagad.appspot.com",
            messagingSenderId: "319326223452",
            appId: "1:319326223452:web:90ce724342c15427a17a99"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let currentTable = null;
        let provisionalOrder = {};

        function goToCustomer(tableNumber) {
            currentTable = tableNumber;
            document.getElementById("main").style.display = "none";
            document.getElementById("customer").style.display = "block";
            document.getElementById("provisionalOrder").style.display = "none";
            document.getElementById("tableNumber").textContent = tableNumber;

            provisionalOrder = {}; // Limpiar la orden provisional al cambiar de mesa
            updateProvisionalQuantities(); // Actualizar cantidades provisionales en la carta
        }

        function goToProvisionalOrder() {
            document.getElementById("customer").style.display = "none";
            document.getElementById("provisionalOrder").style.display = "block";

            const provisionalOrderList = document.getElementById("provisionalOrderList");
            provisionalOrderList.innerHTML = "";

            Object.keys(provisionalOrder).forEach(dish => {
                const quantity = provisionalOrder[dish].quantity;
                const note = provisionalOrder[dish].note || ""; // Obtener nota si existe
                provisionalOrderList.innerHTML += `
                    <div class="order-item">
                        ${dish} x${quantity} - ${quantity * provisionalOrder[dish].price}€
                        <div class="order-item-control">
                            <button style="background-color:red;" onclick="removeProvisionalOrder('${dish}')">-</button>
                            <button style="background-color:green;" onclick="addProvisionalOrder('${dish}', ${provisionalOrder[dish].price})">+</button>
                            <input type="text" placeholder="Notas..." value="${note}" oninput="updateProvisionalNote('${dish}', this.value)">
                        </div>
                    </div>
                `;
            });
        }

        function updateProvisionalNote(dish, note) {
            if (provisionalOrder[dish]) {
                provisionalOrder[dish].note = note;
            }
        }

        function addProvisionalOrder(dish, price) {
            if (provisionalOrder[dish]) {
                provisionalOrder[dish].quantity += 1;
            } else {
                provisionalOrder[dish] = { quantity: 1, price: price, note: "" };
            }
            updateProvisionalQuantities(); // Actualizar cantidades provisionales en la carta
        }

        function removeProvisionalOrder(dish) {
            if (provisionalOrder[dish]) {
                provisionalOrder[dish].quantity -= 1;
                if (provisionalOrder[dish].quantity <= 0) {
                    delete provisionalOrder[dish];
                }
            }
            goToProvisionalOrder(); // Actualizar lista de pedido provisional
        }
// Modificación en la función goToKitchen para asegurar la llamada a checkPassword
function goToKitchen() {
    document.getElementById("main").style.display = "none";
    document.getElementById("kitchen").style.display = "block";
    document.getElementById("kitchenPassword").style.display = "block"; // Mostrar input de contraseña
    document.getElementById("kitchenContent").style.display = "none"; // Ocultar contenido de pedidos inicialmente
    document.getElementById("kitchenPassword").value = ""; // Limpiar el valor del input de contraseña al entrar
}

// Modificación en la función checkPassword para validar la contraseña y mostrar pedidos
function checkPassword() {
    var password = document.getElementById("kitchenPassword").value;
    if (password === "cocina") {
        document.getElementById("kitchenPassword").style.display = "none"; // Ocultar input de contraseña
        document.getElementById("kitchenContent").style.display = "block"; // Mostrar contenido de pedidos
        loadOrders(); // Cargar los pedidos existentes
        database.ref('orders').on('value', function(snapshot) {
            loadOrders(); // Volver a cargar los pedidos si hay cambios en la base de datos
        });
    } else {
        alert("Contraseña incorrecta");
    }
}

// Función loadOrders para cargar y mostrar los pedidos en la interfaz de cocina
function loadOrders() {
    var orderList = document.getElementById("orderList");
    orderList.innerHTML = ""; // Limpiar lista de pedidos antes de cargar
    database.ref('orders').once('value', function(snapshot) {
        snapshot.forEach(function(tableSnapshot) {
            var tableNumber = tableSnapshot.key;
            var orders = tableSnapshot.val();
            var tableDiv = document.createElement("div");
            var tableHeader = document.createElement("h3");
            tableHeader.innerText = "Mesa " + tableNumber + ":";
            tableDiv.appendChild(tableHeader);

            var orderUl = document.createElement("ul");
            orderUl.classList.add("order-list");

            for (var dish in orders) {
                if (orders.hasOwnProperty(dish)) {
                    var li = document.createElement("li");
                    li.classList.add("order-item");
                    li.innerHTML = dish + " (" + orders[dish] + ") " + 
                                   '<button onclick="deleteDish(\'' + tableNumber + '\', \'' + dish + '\')">Eliminar</button>';
                    orderUl.appendChild(li);
                }
            }
            tableDiv.appendChild(orderUl);
            orderList.appendChild(tableDiv);
        });
    });
}


        function updateProvisionalQuantities() {
            Object.keys(provisionalOrder).forEach(dish => {
                const quantity = provisionalOrder[dish].quantity;
                document.getElementById(`provisionalQuantity-${dish}`).textContent = quantity;
            });
        }

        function confirmOrder() {
            const orderRef = database.ref('orders/' + currentTable);
            orderRef.set(provisionalOrder);
            provisionalOrder = {}; // Limpiar el pedido provisional después de confirmar
            goToCustomer(currentTable); // Volver a la vista del cliente
        }


        function removeDish(table, dish) {
            const orderRef = database.ref(`orders/${table}/${dish}`);
            orderRef.remove();
        }

        function toggleDropdown(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle("show");
        }

        function goToMain() {
            document.getElementById("main").style.display = "block";
            document.getElementById("kitchen").style.display = "none";
        }
    </script>
</body>
</html>
