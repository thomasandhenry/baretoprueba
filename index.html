<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Restaurante Interactivo</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <!-- Estilo CSS personalizado -->
    <style>
        /* Estilo para los botones de las secciones */
        button.section {
            padding: 10px 20px;
            font-size: 18px;
            background-color: green;
            color: white;
            border: none;
            cursor: pointer;
            margin: 5px;
        }

        /* Estilo para los botones de los platos */
        .dish {
            display: flex;
            align-items: center;
            margin: 5px 5px 5px 25px; /* Agregar margen izquierdo para tabular */
        }

        .dish span {
            flex-grow: 1;
        }

        .dish button {
            padding: 10px;
            font-size: 18px;
            background-color: blue;
            color: white;
            border: none;
            cursor: pointer;
            margin-left: 10px;
        }

        /* Estilo para los botones al pasar el ratón */
        button:hover {
            opacity: 0.8;
        }

        /* Disposición vertical de las mesas */
        #main {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #main button {
            width: 200px;
        }

        /* Ocultar lista desplegable por defecto */
        .dropdown-content {
            display: none;
            flex-direction: column;
            align-items: flex-start;
        }

        /* Mostrar lista desplegable cuando se hace clic */
        .show {
            display: flex;
        }

        /* Estilo para el contenedor de cocina */
        #kitchenContent {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        /* Estilo para la lista de pedidos */
        .order-list {
            list-style-type: none;
            padding-left: 20px;
        }

        .order-item {
            margin-left: 20px;
        }

        .order-item-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin: 10px 0;
        }

        .order-item-control button {
            padding: 5px 10px;
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div id="main">
        <h1>Selecciona tu mesa</h1>
        <button class="section" onclick="goToCustomer(1)">Mesa 1</button>
        <button class="section" onclick="goToCustomer(2)">Mesa 2</button>
        <button class="section" onclick="goToCustomer(3)">Mesa 3</button>
        <button class="section" onclick="goToCustomer(4)">Mesa 4</button>
        <button class="section" onclick="goToCustomer(5)">Mesa 5</button>
        <button class="section" onclick="goToCustomer(6)">Mesa 6</button>
        <button class="section" onclick="goToCustomer(7)">Mesa 7</button>
        <button class="section" onclick="goToCustomer(8)">Mesa 8</button>
        <button class="section" onclick="goToCustomer(9)">Mesa 9</button>
        <button class="section" onclick="goToCustomer(10)">Mesa 10</button>
        <button class="section" onclick="goToKitchen()">COCINA</button>
    </div>

    <div id="customer" style="display:none;">
        <h1>Cliente - Mesa <span id="tableNumber"></span></h1>
        <div>
            <button class="section" onclick="toggleDropdown('entrantes')">Entrantes</button>
            <div id="entrantes" class="dropdown-content">
                <div class="dish"><span>Jamón ibérico - 5€</span><span>(<span id="count-Jamón ibérico">0</span>)</span><button onclick="addProvisionalOrder('Jamón ibérico', 5)">+</button></div>
                <div class="dish"><span>Ensaladilla rusa - 3€</span><span>(<span id="count-Ensaladilla rusa">0</span>)</span><button onclick="addProvisionalOrder('Ensaladilla rusa', 3)">+</button></div>
                <div class="dish"><span>Croquetas - 4€</span><span>(<span id="count-Croquetas">0</span>)</span><button onclick="addProvisionalOrder('Croquetas', 4)">+</button></div>
            </div>
        </div>
        <div>
            <button class="section" onclick="toggleDropdown('platosPrincipales')">Platos principales</button>
            <div id="platosPrincipales" class="dropdown-content">
                <div class="dish"><span>Filete de ternera - 12€</span><span>(<span id="count-Filete de ternera">0</span>)</span><button onclick="addProvisionalOrder('Filete de ternera', 12)">+</button></div>
                <div class="dish"><span>Merluza al horno - 10€</span><span>(<span id="count-Merluza al horno">0</span>)</span><button onclick="addProvisionalOrder('Merluza al horno', 10)">+</button></div>
                <div class="dish"><span>Tartar de salmón y aguacate - 15€</span><span>(<span id="count-Tartar de salmón y aguacate">0</span>)</span><button onclick="addProvisionalOrder('Tartar de salmón y aguacate', 15)">+</button></div>
            </div>
        </div>
        <div>
            <button class="section" onclick="toggleDropdown('postres')">Postres</button>
            <div id="postres" class="dropdown-content">
                <div class="dish"><span>Tarta de la abuela - 5€</span><span>(<span id="count-Tarta de la abuela">0</span>)</span><button onclick="addProvisionalOrder('Tarta de la abuela', 5)">+</button></div>
                <div class="dish"><span>Natillas - 3€</span><span>(<span id="count-Natillas">0</span>)</span><button onclick="addProvisionalOrder('Natillas', 3)">+</button></div>
                <div class="dish"><span>Tarta de queso y fruta - 6€</span><span>(<span id="count-Tarta de queso y fruta">0</span>)</span><button onclick="addProvisionalOrder('Tarta de queso y fruta', 6)">+</button></div>
            </div>
        </div>
        <div>
            <button class="section" onclick="toggleDropdown('bebidas')">Bebidas</button>
            <div id="bebidas" class="dropdown-content">
                <div class="dish"><span>Cocacola - 2€</span><span>(<span id="count-Cocacola">0</span>)</span><button onclick="addProvisionalOrder('Cocacola', 2)">+</button></div>
                <div class="dish"><span>Agua - 1€</span><span>(<span id="count-Agua">0</span>)</span><button onclick="addProvisionalOrder('Agua', 1)">+</button></div>
                <div class="dish"><span>Cerveza - 3€</span><span>(<span id="count-Cerveza">0</span>)</span><button onclick="addProvisionalOrder('Cerveza', 3)">+</button></div>
                <div class="dish"><span>Vino - 4€</span><span>(<span id="count-Vino">0</span>)</span><button onclick="addProvisionalOrder('Vino', 4)">+</button></div>
            </div>
        </div>
        <button class="section" onclick="goToProvisionalOrder()">Tramitar pedido</button>
    </div>

    <div id="provisionalOrder" style="display:none;">
        <h1>PEDIDO</h1>
        <div id="provisionalOrderList"></div>
        <button class="section" style="background-color:green;" onclick="confirmOrder()">CONFIRMAR</button>
        <button class="section" style="background-color:red;" onclick="goBackToCustomer()">ATRÁS</button>
    </div>

    <div id="kitchen" style="display:none;">
        <h1>Cocina</h1>
        <div id="kitchenContent"></div>
        <button class="section" onclick="goBackToMain()">ATRÁS</button>
    </div>

    <script>
        // Configuración de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBxx-5flCIuGTH8iyPEaR9u0ViU1UPLQFg",
            authDomain: "proyecto-restaurante-c1080.firebaseapp.com",
            databaseURL: "https://proyecto-restaurante-c1080-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "proyecto-restaurante-c1080",
            storageBucket: "proyecto-restaurante-c1080.appspot.com",
            messagingSenderId: "662016608555",
            appId: "1:662016608555:web:21d2300cf72a19b0055c11",
            measurementId: "G-9Q7EK1Z818"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let currentTableNumber = null;
        const provisionalOrders = {};

        function goToCustomer(tableNumber) {
            currentTableNumber = tableNumber;
            document.getElementById("tableNumber").innerText = tableNumber;
            document.getElementById("main").style.display = "none";
            document.getElementById("customer").style.display = "block";
        }

        function goToProvisionalOrder() {
            document.getElementById("customer").style.display = "none";
            document.getElementById("provisionalOrder").style.display = "block";
            displayProvisionalOrders();
        }

        function goBackToCustomer() {
            document.getElementById("provisionalOrder").style.display = "none";
            document.getElementById("customer").style.display = "block";
        }

        function goToKitchen() {
            document.getElementById("main").style.display = "none";
            document.getElementById("kitchen").style.display = "block";
            displayOrdersInKitchen();
        }

        function goBackToMain() {
            document.getElementById("kitchen").style.display = "none";
            document.getElementById("main").style.display = "block";
        }

        function toggleDropdown(section) {
            document.getElementById(section).classList.toggle("show");
        }

        function addProvisionalOrder(dish, price) {
            if (!provisionalOrders[currentTableNumber]) {
                provisionalOrders[currentTableNumber] = {};
            }
            if (!provisionalOrders[currentTableNumber][dish]) {
                provisionalOrders[currentTableNumber][dish] = { quantity: 0, price: price, note: "" };
            }
            provisionalOrders[currentTableNumber][dish].quantity++;
            document.getElementById(`count-${dish}`).innerText = provisionalOrders[currentTableNumber][dish].quantity;
        }

        function removeProvisionalOrder(dish) {
            if (provisionalOrders[currentTableNumber] && provisionalOrders[currentTableNumber][dish]) {
                if (provisionalOrders[currentTableNumber][dish].quantity > 0) {
                    provisionalOrders[currentTableNumber][dish].quantity--;
                    if (provisionalOrders[currentTableNumber][dish].quantity === 0) {
                        delete provisionalOrders[currentTableNumber][dish];
                    }
                }
                document.getElementById(`count-${dish}`).innerText = provisionalOrders[currentTableNumber][dish] ? provisionalOrders[currentTableNumber][dish].quantity : 0;
            }
        }

        function displayProvisionalOrders() {
            const orderList = document.getElementById("provisionalOrderList");
            orderList.innerHTML = "";
            const orders = provisionalOrders[currentTableNumber];
            let total = 0;
            for (let dish in orders) {
                const itemTotalPrice = orders[dish].quantity * orders[dish].price;
                total += itemTotalPrice;
                const orderItem = document.createElement("div");
                orderItem.className = "order-item";
                orderItem.innerHTML = `
                    <span>${dish} (${orders[dish].quantity}) - ${itemTotalPrice}€</span>
                    <div>
                        <button style="background-color:green;" onclick="addProvisionalOrder('${dish}', ${orders[dish].price})">+</button>
                        <button style="background-color:red;" onclick="removeProvisionalOrder('${dish}')">-</button>
                        <button onclick="toggleNoteInput('${dish}')">Añadir nota</button>
                    </div>
                    <div id="noteInput-${dish}" style="display:none;">
                        <input type="text" id="noteText-${dish}" value="${orders[dish].note}" placeholder="Escribe una nota">
                        <button onclick="saveNote('${dish}')">Guardar nota</button>
                    </div>
                `;
                orderList.appendChild(orderItem);
            }
            const totalItem = document.createElement("div");
            totalItem.className = "order-item";
            totalItem.innerHTML = `<strong>Total: ${total}€</strong>`;
            orderList.appendChild(totalItem);
        }

        function toggleNoteInput(dish) {
            const noteInputDiv = document.getElementById(`noteInput-${dish}`);
            if (noteInputDiv.style.display === "none") {
                noteInputDiv.style.display = "block";
            } else {
                noteInputDiv.style.display = "none";
            }
        }

        function saveNote(dish) {
            const noteText = document.getElementById(`noteText-${dish}`).value;
            provisionalOrders[currentTableNumber][dish].note = noteText;
            alert(`Nota guardada para ${dish}: ${noteText}`);
        }

        function confirmOrder() {
            const orders = provisionalOrders[currentTableNumber];
            for (let dish in orders) {
                const orderRef = database.ref('orders').push();
                orderRef.set({
                    tableNumber: currentTableNumber,
                    dish: dish,
                    quantity: orders[dish].quantity,
                    price: orders[dish].price,
                    note: orders[dish].note
                });
            }
            provisionalOrders[currentTableNumber] = {};
            goBackToCustomer();
        }

        function displayOrdersInKitchen() {
            const kitchenContent = document.getElementById("kitchenContent");
            kitchenContent.innerHTML = "";
            const ordersRef = database.ref('orders');
            ordersRef.once('value', (snapshot) => {
                const orders = snapshot.val();
                for (let orderId in orders) {
                    const order = orders[orderId];
                    const orderItem = document.createElement("div");
                    orderItem.className = "order-item-control";
                    orderItem.innerHTML = `
                        <span>Mesa ${order.tableNumber}: ${order.dish} (${order.quantity}) - ${order.price}€</span>
                        <span>Nota: ${order.note ? order.note : 'Sin nota'}</span>
                        <button style="background-color:red;" onclick="deleteOrder('${orderId}')">Eliminar</button>
                    `;
                    kitchenContent.appendChild(orderItem);
                }
            });
        }

        function deleteOrder(orderId) {
            const orderRef = database.ref('orders/' + orderId);
            orderRef.remove().then(() => {
                displayOrdersInKitchen();
            });
        }
    </script>
</body>
</html>
